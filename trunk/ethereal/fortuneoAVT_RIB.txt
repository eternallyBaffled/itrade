<META HTTP-EQUIV='Expires' CONTENT='Fri, Jun 12 1981 08:20:00 GMT'>
<META HTTP-EQUIV='Pragma' CONTENT='no-cache'>
<META HTTP-EQUIV='Cache-Control' CONTENT='no-cache'>
<html>
<script>


function fdslkjb8928d( b )
{
	switch( b )
	{
		case "NGI877"	: return 5000;
		default		: return 2750;	//2941
	}
}









var serveurValueIndex			='/EE4MW0mfgE7E.sqI.1GkfLs5874';
var ancienneListeValeursCompressee	= null;
var ancienneListeValeurs		= null;
var ancienArrayValeurs			= null;
var ancienneHorloge			= '';
var ancienneChaineCAC			= '';
var listeValeurs			= null;
var arrayValeurs			= null;
var sicovamFieldName 			= "sicovam_" + ( new Date() ).getTime(); //Pour eviter la saisie semi-auto
var largeurColonne			= 60;
var largeurFenetreOrigine		= 900;
var hauteurFenetreOrigine		= 145;
var etatAllume				= false;
var flag				= ( "" + top.location ).substring( ( "" + top.location ).length - 6 );
var serveurAssocieBV			= (
						(
							document
							.URL
							.split( "//" )[ 1 ]
							.split( "/" )[ 0 ] ==
							"192.168.200.42"
						)?
						"192.168.100.224"	:
						"www" +
						(	( flag != "NGI877" ) ?
							".fortezza.server01.fr"
							.substring( 0, 5 ) +
							"un" +
							( "0eo" ).substring( 1 ) +
							".fr" :
							".inve" +
							( "st.in" ).substring( 0 ) +
							"gdir" +
							"ect" +
							".fr"
						)
					);

var topColor		= "#B2EA65";
var backColor		= "#EEEEEE";
var fontTopColor	= "black";


if( flag == "NGI877" )
{
	topColor	= "#537bc5";
	backColor	= "#FFF4E4";
	fontTopColor	= "white";
}


if( navigator.appVersion.indexOf( "Macintosh" ) < 0 )
	window.resizeTo( largeurFenetreOrigine, hauteurFenetreOrigine );

function affecterCouleurDiode( diode )
{
	if( !window.frames[ 2 ] || !window.frames[ 2 ].document.getElementById( diode ) )
		return;
	window.frames[ 2 ].document.getElementById( diode ).style.background="#FFFFFF"
}

function animerDiode()
{
	if( !window.frames[ 2 ] || !window.frames[ 2 ].document.getElementById( "diodeConnexion" ) )
		return;
	window.frames[ 2 ].document.getElementById( "diodeConnexion" ).style.background="#00FF00";
	window.setTimeout( 'affecterCouleurDiode( "diodeConnexion" )', 500 );
}
function animerDiode2()
{
	if( !window.frames[ 2 ] || !window.frames[ 2 ].document.getElementById( "diodeConnexion2" ) )
		return;
	window.frames[ 2 ].document.getElementById( "diodeConnexion2" ).style.background="#00FF00";
	window.setTimeout( 'affecterCouleurDiode( "diodeConnexion2" )', 500 );
}

function miniGraphe( cours )
{
	var res = "<table cellpadding='0' cellspacing='0' border='0'>";
	var tmpTab = new Array();
	var tmpTab2 = new Array();
	for( var i in cours )
	{
		if( tmpTab[ cours[ i ] ] || !( parseFloat( cours[ i ] ) > 0 ) )
			continue;
		tmpTab[ cours[ i ] ] = true;
		tmpTab2[ tmpTab2.length ] = parseFloat( cours[ i ] );
		
	}

	for( var i = 0; i < tmpTab2.length; i++ )
		for( var j = i; j < tmpTab2.length; j++ )
			if( parseFloat( tmpTab2[ i ] ) > parseFloat( tmpTab2[ j ] ) )
			{
				var t = tmpTab2[ j ];
				tmpTab2[ j ] = tmpTab2[ i ];
				tmpTab2[ i ] = t;
			}

	function indexOf( tab, value )
	{
		for( var i in tab )
			if( tab[ i ] == value )
				return i;
		return null;
	}
	var valeurs = new Array();

	for( var i in cours )
		valeurs[ valeurs.length ] = indexOf( tmpTab2, cours[ i ] );

	for( var i = 0; i < 5; i++ )
	{
		res += "<tr>";
		for( var j = 0; j < 5; j++ )
		{
			var bgcolor = null;
			res += "<td ";
			if( valeurs[ j ] != null && i == 4 - valeurs[ j ] )
				res += "bgcolor='#000000'";
			res += ">";
			res += "<img height='2px' width='10px'>"; //src='http://marketzoom.fortuneo.fr/_common/images/pixel.gif'
			res += "</td>";
		}
		res += "</tr>";
	}
	res += "</table>";
	return res;
}
//if( window.fenetresAutorefresh == null )
window.fenetresAutorefresh = new Array();
fenetresAutorefresh[ fenetresAutorefresh.length ] = window;

function nettoyerFenetresAutorefresh()
{
	var res = new Array();
	for( var i in fenetresAutorefresh )
		if( fenetresAutorefresh[ i ] != null && !fenetresAutorefresh[ i ].closed )
			res[ res.length ] = fenetresAutorefresh[ i ];
	return fenetresAutorefresh = res;
}

function initFenetresAutorefresh()
{
	fenetresAutorefresh = new Array();
}

var focusAll_lock = false;
function lock_focusAll()
{
	focusAll_lock = true;
	window.setTimeout( "focusAll_lock = false", 1000 );
}

function focusAll()
{
	if( focusAll_lock ) return;
	lock_focusAll();
	nettoyerFenetresAutorefresh();
	var fenetresAutorefresh_bis = fenetresAutorefresh;
	for( var i in fenetresAutorefresh_bis )
	{
		// Si la fenetre n'est pas encore chargee, on repousse la demande de 3 secondes
		if( !fenetresAutorefresh_bis[ i ].window || !fenetresAutorefresh_bis[ i ].window.initFenetresAutorefresh )
		{
			window.setTimeout( "focusAll()", 3000 );
			return;
		}
		fenetresAutorefresh_bis[ i ].window.initFenetresAutorefresh()
		for( var j in fenetresAutorefresh_bis )
			fenetresAutorefresh_bis[ i ].window.fenetresAutorefresh[
				fenetresAutorefresh_bis[ i ].window.fenetresAutorefresh.length ]
				= fenetresAutorefresh_bis[ j ];
		fenetresAutorefresh_bis[ i ].moveTo( 0, i * hauteurFenetreOrigine );
		fenetresAutorefresh_bis[ i ].lock_focusAll();
		fenetresAutorefresh_bis[ i ].autoRefresh_staticPart.focus();
	}
	window.frames[ 2 ].document.getElementById( "zoneSaisie" ).style.visibility="hidden";
	window.frames[ 2 ].document.getElementById( sicovamFieldName ).value = "";
	window.frames[ 2 ].focus();
}

function ouvrirAide()
{
	window.open(
			"http://" + serveurAssocieBV + "/autoRefresh/aide" +
			( ( flag == "NGI877" ) ? flag : "" ) +
			".html",
			"",
			"status=no,width=600,height=600,resizable=no,menubar=no,scrollbars=1"
			);
}

function ouvrirNouvelleFenetre( url )
{
	var opener	= top;
	if( window.opener && !window.opener.closed )
		opener	= window.opener.top;
	nettoyerFenetresAutorefresh();
	var newWindow	=	opener.open(
				url,
				"",
				"status=no,width=850,height=125,resizable=no,menubar=no,scrollbars=0,alwaysRaised=yes,left=0,top="
				+ ( fenetresAutorefresh.length * hauteurFenetreOrigine )
				);
	fenetresAutorefresh[ fenetresAutorefresh.length ] = newWindow;
	focusAll();
	//newWindow.window.frames[ 2 ].focus();
	window.frames[ 2 ].document.getElementById( "zoneSaisie" ).style.visibility="hidden";
	window.frames[ 2 ].document.getElementById( sicovamFieldName ).value = "";
}

var listeOrdonneeChamps = new Array
(	
	// CAC (obtenu par concatenation)
	"CAC_CRS_DERNIER",
	"CAC_VAR_VEILLE",
	"CAC_CRS_PREMIER",
	"CAC_CRS_HAUT",
	"CAC_CRS_BAS",
	"CAC_H_COURS",

	// Titre
	"CSA_PLACE_COT",
	"CSA_CODE_SICO", //(507:CSA_CODE_ISIN)
	"CSA_LIB_COURT",

	// Tableau recapitulatif
	// "CSA_CRS_DERNIER" est compris a la fin
	"CSA_VAR_VEILLE",
	"CSA_CRS_PREMIER",
	"CSA_CRS_HAUT",
	"CSA_CRS_BAS",
	"CSA_VOL_JOUR",
	
	// Carnet d'ordres
	"CSA_NBL_DEM1",	"CSA_VOL_DEM1",	"CSA_CRS_DEM1",	"CSA_CRS_OFF1",	"CSA_VOL_OFF1",	"CSA_NBL_OFF1",
	"CSA_NBL_DEM2",	"CSA_VOL_DEM2",	"CSA_CRS_DEM2",	"CSA_CRS_OFF2",	"CSA_VOL_OFF2",	"CSA_NBL_OFF2",
	"CSA_NBL_DEM3",	"CSA_VOL_DEM3",	"CSA_CRS_DEM3",	"CSA_CRS_OFF3",	"CSA_VOL_OFF3",	"CSA_NBL_OFF3",
	"CSA_NBL_DEM4",	"CSA_VOL_DEM4",	"CSA_CRS_DEM4",	"CSA_CRS_OFF4",	"CSA_VOL_OFF4",	"CSA_NBL_OFF4",
	"CSA_NBL_DEM5",	"CSA_VOL_DEM5",	"CSA_CRS_DEM5",	"CSA_CRS_OFF5",	"CSA_VOL_OFF5",	"CSA_NBL_OFF5",
			/* FMP */	"CSA_FMP_DEM",	"CSA_FMP_OFF",	/* FMP Qte */	"CSA_FMP_QTE",

	// CMP
	"CSA_CAPITAUX",

	// Etat
	"CSA_COT_GRP",
	"CSA_IND_ETAT",
	"CS_H_REPRIS_COT",
	"CSA_RESERV_BAS",
	"CSA_RESERV_HAUT",

	// Dernieres transactions
	"CSA_H_COURS",		"CSA_VOL_DERNIER",	"CSA_CRS_DERNIER",
	"CSA_H_TRANS_2",	"CSA_VOL_TRANS_2",	"CSA_CRS_TRANS_2",	
	"CSA_H_TRANS_3",	"CSA_VOL_TRANS_3",	"CSA_CRS_TRANS_3",	
	"CSA_H_TRANS_4",	"CSA_VOL_TRANS_4",	"CSA_CRS_TRANS_4",	
	"CSA_H_TRANS_5",	"CSA_VOL_TRANS_5",	"CSA_CRS_TRANS_5"

);


var structPage =
{
	
	"CSA_LIB_COURT":
	new Array
	(
		new Array( "BOUTON_SICOVAM"	, "CSA_CODE_SICO"	),
		new Array( "Dernier"		, "CSA_CRS_DERNIER"	),
		new Array( "Var."		, "CSA_VAR_VEILLE"	),
		new Array( "Ouv."		, "CSA_CRS_PREMIER"	),
		new Array( "+Haut"		, "CSA_CRS_HAUT"	),
		new Array( "+Bas"		, "CSA_CRS_BAS"		),
		new Array( "Vol."		, "CSA_VOL_JOUR"	)
	),

	"CAC40":
	new Array
	(
		new Array( "&nbsp;"		),
		new Array( "CAC_CRS_DERNIER"	),
		new Array( "CAC_VAR_VEILLE"	),
		new Array( "CAC_CRS_PREMIER"	),
		new Array( "CAC_CRS_HAUT"	),
		new Array( "CAC_CRS_BAS"	),
		new Array( "CAC_H_COURS"	) 
	),
	
	"Carnet d`ordres":
	new Array
	(
		new Array( "Nb",		"Qté",		"Achat",	"Vente",		"Qté",		"Nb"		),
		new Array( "CSA_NBL_DEM1",	"CSA_VOL_DEM1",	"CSA_CRS_DEM1",	"CSA_CRS_OFF1",	"CSA_VOL_OFF1",	"CSA_NBL_OFF1"	),
		new Array( "CSA_NBL_DEM2",	"CSA_VOL_DEM2",	"CSA_CRS_DEM2",	"CSA_CRS_OFF2",	"CSA_VOL_OFF2",	"CSA_NBL_OFF2"	),
		new Array( "CSA_NBL_DEM3",	"CSA_VOL_DEM3",	"CSA_CRS_DEM3",	"CSA_CRS_OFF3",	"CSA_VOL_OFF3",	"CSA_NBL_OFF3"	),
		new Array( "CSA_NBL_DEM4",	"CSA_VOL_DEM4",	"CSA_CRS_DEM4",	"CSA_CRS_OFF4",	"CSA_VOL_OFF4",	"CSA_NBL_OFF4"	),
		new Array( "CSA_NBL_DEM5",	"CSA_VOL_DEM5",	"CSA_CRS_DEM5",	"CSA_CRS_OFF5",	"CSA_VOL_OFF5",	"CSA_NBL_OFF5"	),
		new Array( "",			"FMP",		"CSA_FMP_DEM",	"CSA_FMP_OFF",	"",		""	)
	),

	"Dernières transactions" :
	new Array
	(
		new Array( "Heure",		"Qté",			"Cours"			),
		new Array( "CSA_H_COURS",	"CSA_VOL_DERNIER",	"CSA_CRS_DERNIER"	),
		new Array( "CSA_H_TRANS_2",	"CSA_VOL_TRANS_2",	"CSA_CRS_TRANS_2"	),
		new Array( "CSA_H_TRANS_3",	"CSA_VOL_TRANS_3",	"CSA_CRS_TRANS_3"	),
		new Array( "CSA_H_TRANS_4",	"CSA_VOL_TRANS_4",	"CSA_CRS_TRANS_4"	),	
		new Array( "CSA_H_TRANS_5",	"CSA_VOL_TRANS_5",	"CSA_CRS_TRANS_5"	),
		new Array( "MINI_GRAPHE",	"CMP",			"CSA_CRS_MOYP"		)
	),
	
	"Séance":
	new Array
	(
		new Array( "Achat"		, "ICONE_ACHAT"		),
		new Array( "Vente"		, "ICONE_VENTE"		),
		new Array( "Statut"		, "CSA_IND_ETAT"	),
		new Array( "Reprise"		, "CS_H_REPRIS_COT"	),
		new Array( "Seuil H"		, "CSA_RESERV_HAUT"	),
		new Array( "Seuil B"		, "CSA_RESERV_BAS"	),
		new Array( "BOUTON_AIDE" 	, "DIODE_CONNEXION"	)
	)
};

var indexChamp = new Array();
for( var i in listeOrdonneeChamps )
	indexChamp[ listeOrdonneeChamps[ i ] ] = i;

var chaineCAC;
	

var couleurAffichage_panelCouleurs = new Array
	(
		"#AAAAFF",	// Evolution valeur neutre
		"#33FF33",	// Evolution a connotation positive
		"#FF3333"	// Evolution a connotation negative
	);

function couleurAffichage( nomChamp )
{
	if( ancienneListeValeurs == null )
		return null;
	
	switch( nomChamp )
	{
		case	"CAC_CRS_DERNIER"	:	
		case	"CAC_VAR_VEILLE"	:
		case	"CAC_CRS_PREMIER"	:
		case	"CAC_CRS_HAUT"		:
		case	"CAC_CRS_BAS"		:
		case	"CSA_VAR_VEILLE"	:
		case	"CSA_CRS_PREMIER"	:
		case	"CSA_CRS_HAUT"		:
		case	"CSA_CRS_BAS"		:

			if(	arrayValeurs[ indexChamp[ nomChamp ] ] ==
				ancienArrayValeurs[ indexChamp[ nomChamp ] ] )
				return null;
			
			if(	parseFloat( arrayValeurs[ indexChamp[ nomChamp ] ] ) >
				parseFloat( ancienArrayValeurs[ indexChamp[ nomChamp ] ] ) )
				return couleurAffichage_panelCouleurs[ 1 ];

			if(	parseFloat( arrayValeurs[ indexChamp[ nomChamp ] ] ) <
				parseFloat( ancienArrayValeurs[ indexChamp[ nomChamp ] ] ) )
				return couleurAffichage_panelCouleurs[ 2 ];

			return couleurAffichage_panelCouleurs[ 0 ];

		case	"CSA_CRS_DERNIER"	:

			if(	parseFloat( arrayValeurs[ indexChamp[ nomChamp ] ] ) >
				parseFloat( ancienArrayValeurs[ indexChamp[ nomChamp ] ] ) )
				return couleurAffichage_panelCouleurs[ 1 ];

			if(	parseFloat( arrayValeurs[ indexChamp[ nomChamp ] ] ) <
				parseFloat( ancienArrayValeurs[ indexChamp[ nomChamp ] ] ) )
				return couleurAffichage_panelCouleurs[ 2 ];

			if(	arrayValeurs[ indexChamp[ "CSA_H_COURS" ] ] !=
				ancienArrayValeurs[ indexChamp[ "CSA_H_COURS" ] ] ||
				arrayValeurs[ indexChamp[ "CSA_VOL_DERNIER" ] ] !=
				ancienArrayValeurs[ indexChamp[ "CSA_VOL_DERNIER" ] ]
				)
				return couleurAffichage_panelCouleurs[ 0 ];

			return null;

		// CSA_H_COURS et CSA_VOL_DERNIER ont meme couleur que le cours
		case	"CSA_H_COURS"		:
		case	"CSA_VOL_DERNIER"	:
			return couleurAffichage( "CSA_CRS_DERNIER" );
	}
	switch( nomChamp.slice( 0, -1 ) )
	{
		case "CSA_H_TRANS_":
		case "CSA_VOL_TRANS_":
		case "CSA_CRS_TRANS_":
			var chaineRecherche
				= arrayValeurs[ indexChamp[ "CSA_H_TRANS_"	+ nomChamp.slice( -1 ) ] ]
				+ ";"
				+ arrayValeurs[ indexChamp[ "CSA_VOL_TRANS_"	+ nomChamp.slice( -1 ) ] ]
				+ ";"
				+ arrayValeurs[ indexChamp[ "CSA_CRS_TRANS_"	+ nomChamp.slice( -1 ) ] ];
			
			if( ancienneListeValeurs.search( chaineRecherche ) > -1 )
			// Si la transaction existait deja dans l'ancien tableau
				return null;

			// Si le cours de la transaction consideree est superieur a l'ancien cours
			var coursConsidere =
				parseFloat
				( arrayValeurs
					[ indexChamp
						[ "CSA_CRS_TRANS_" + nomChamp.slice( -1 ) ]
					]
				);
			
			var ancienCours =
				parseFloat
				( ancienArrayValeurs
					[ indexChamp[ "CSA_CRS_DERNIER" ] ]
				);
			
			if( coursConsidere == ancienCours )	return couleurAffichage_panelCouleurs[ 0 ];
			if( coursConsidere > ancienCours )	return couleurAffichage_panelCouleurs[ 1 ];
			if( coursConsidere < ancienCours )	return couleurAffichage_panelCouleurs[ 2 ];
	}

	if(	arrayValeurs[ indexChamp[ nomChamp ] ] !=
		ancienArrayValeurs[ indexChamp[ nomChamp ] ] )
		return couleurAffichage_panelCouleurs[ 0 ];

	return null;
}

function formateSiEntier( i )
{
	if( i != "" + parseInt( i ) )
		return i;
	var i	= "" + i;
	var res	= "";
	while( i.length > 0 )
	{
		res = " " + i.slice( -3 ) + res;
		i = i.slice( 0, -3 );
	}
	return res.slice( 1 );
}

//function chaineTransformee( nomChamp ){ return formateSiEntier( _chaineTransformee( nomChamp ) ); }

function chaineTransformee( nomChamp ){ return _chaineTransformee( nomChamp ); }
function _chaineTransformee( nomChamp )
{
	switch( nomChamp )
	{
		case	"BOUTON_AIDE"		:
			return	"<input type=button class=bouton value='A I D E' style=width:60px;text-align:center onclick=parent.ouvrirAide()>";
				
		case	"BOUTON_SICOVAM"	:
			return	"<input type=button class=bouton value='C O D E' style=text-align:center;margin-bottom:0px;width:60px; onclick='document.getElementById( \"zoneSaisie\" ).style.visibility=\"visible\"' >"
		case	"CS_H_REPRIS_COT"	:
			if( arrayValeurs[ indexChamp[ nomChamp ] ].length == 0 )
				return "-";
			return arrayValeurs[ indexChamp[ nomChamp ] ];

		case "CSA_CRS_MOYP":
			var res = (parseFloat(
					Math.round(
						parseFloat( arrayValeurs[ indexChamp[ "CSA_CAPITAUX" ] ] * 100 )
						/
						parseFloat( arrayValeurs[ indexChamp[ "CSA_VOL_JOUR" ] ] )
						)
					) / 100);
			return ( isNaN( res ) )? "-" : res;
		case "MINI_GRAPHE":
			var tabCours = new Array();
			var champCours = new Array(
				"CSA_CRS_TRANS_5",
				"CSA_CRS_TRANS_4",
				"CSA_CRS_TRANS_3",
				"CSA_CRS_TRANS_2",
				"CSA_CRS_DERNIER" );
			
			for( var i in champCours )
				tabCours[ tabCours.length ] =
					arrayValeurs[ indexChamp[ champCours[ i ] ] ];

			return miniGraphe( tabCours );
		
		case "DIODE_CONNEXION":
			return	"<input type='button' class='diode' value=' ' name='diodeConnexion' id='diodeConnexion'>" +
				"<input type='button' class='diode' value=' ' name='diodeConnexion2' id='diodeConnexion2'>";

		case "CSA_CODE_SICO":
			return arrayValeurs[ indexChamp[ nomChamp ] ];

		case "CSA_IND_ETAT":
			switch( arrayValeurs[ indexChamp[ nomChamp ] ] )
			{
				case "H" : return "Res. H";
				case "B" : return "<font color='red'>Res. B</font>";
				case "P" : return "Res.";
				case " " : return "OK";
				case "" : return "OK";
				default	 : return arrayValeurs[ indexChamp[ nomChamp ] ];
			}
		
		case "ICONE_ACHAT":
			return	"<input type='button' class='icone' onclick='javascript:top.achat();' value='+'>"
		case "ICONE_VENTE":
			return	"<input type='button' class='icone' onclick='javascript:top.vente();' value='-'>"

		case "CSA_VAR_VEILLE":
			if( !parseFloat( arrayValeurs[ indexChamp[ "CSA_CRS_DERNIER" ] ] ) ) return "-";
			return pourcentageFormate( arrayValeurs[ indexChamp[ nomChamp ] ] );
		case "CAC_VAR_VEILLE":
			if( !parseFloat( arrayValeurs[ indexChamp[ "CAC_CRS_DERNIER" ] ] ) ) return "-";
			return pourcentageFormate( arrayValeurs[ indexChamp[ nomChamp ] ] );
		case "CSA_LIB_COURT":
		{
			return( ( arrayValeurs[ indexChamp[ nomChamp ] ].length > 12 )
				?
				arrayValeurs[ indexChamp[ nomChamp ] ].slice( 0, 12 )
				+ "..."
				:
				arrayValeurs[ indexChamp[ nomChamp ] ] );
		}
	}
	switch( nomChamp.slice( 0, -1 ) )
	{
		case "CSA_CRS_DEM": // 1 a 5
		case "CSA_CRS_OFF": // 1 a 5
		switch( parseFloat( arrayValeurs[ indexChamp[ nomChamp ] ] ) )
		{
			case -2.00:
				return "ATP";
			case 0.00:
				// Si il existe un volume demande associe
				if( parseInt(
					arrayValeurs[
						indexChamp[ 
							"CSA_VOL_" +
							nomChamp.substring( 8 )
							]
						] )
					!= 0 )
					return "APM";
				return "-";

			default	: return arrayValeurs[ indexChamp[ nomChamp ] ];
		}
		case "CSA_NBL_DEM":
		case "CSA_VOL_DEM":
		case "CSA_VOL_OFF":
		case "CSA_NBL_OFF":
			if( parseInt( arrayValeurs[ indexChamp[ nomChamp ] ] ) != 0 )
				return arrayValeurs[ indexChamp[ nomChamp ] ];
			return "-";
	}
	
	if( indexChamp[ nomChamp ] == null )
		return nomChamp;
	
	if(	arrayValeurs[ indexChamp[ nomChamp ] ] == null || 
		parseFloat( arrayValeurs[ indexChamp[ nomChamp ] ] ) == 0 )
		return "-";

	return arrayValeurs[ indexChamp[ nomChamp ] ];
}
                        


function formatSico( mnemo )
{
	if( !isNaN( mnemo.charAt( 0 ) ) )
		while( mnemo.length < 5 )
			mnemo = "0" + mnemo;

	return mnemo;
	
/*
	sico = "" + parseInt( sico );
	while( sico.length < 6 )
		sico = "0" + sico;
	return sico;
*/
}

// Appel d'un lien Achat ou Vente
function transaction( sens )
{
	// Impossible sous Mac
	if( navigator.appVersion.indexOf( "Macintosh" ) >= 0 )
	{
		alert( "Indisponible sous système Macintosh" );
		return;
	}
		

	if(	window.opener		== null ||
		window.opener.closed		||
		window.opener.top	== null ||
		window.opener.top.main	== null )
	{
		alert( "Vous avez fermé la fenetre de transaction originale. L'application du lien Achat/Vente est impossible." );
		return;
	}

	var url =	"https://" +
			serveurAssocieBV +
			"/switchFromIS.html?CodePlace=PSE&CodeISIN=" +
			formatSico( arrayValeurs[ indexChamp[ ( ( flag != "NGI877" ) ? "CSA_CODE_SICO" : "CSA_LIB_COURT" ) ] ] ) +
			"&SensAchatVente=" +
			sens +
			"&d=" +
			( new Date() ).getTime();

	window.opener.top.focus();
	window.opener.top.main.location=url;
	top.focus();
}

function achat(){ transaction( "Achat" ); }
function vente(){ transaction( "Vente" ); }


function decomp( str )
{
	var base		= 92;
	var baseT		= " !#$%&()*+,./0123456789:;<=?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[]^_`abcdefghijklmnopqrstuvwxyz{|}~¡¢£¤¥¦§¨©ª«¬­®¯°±²³´µ¶·¸¹º»¼½¾¿ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÚÛÜÝÞßàáâãäåæçèéêëìíîïðñòóôõö÷øùúûüýþ";
	var struct_trame	= ";S;S;.;.;.;.;;;;.;.;;;;;.;.;;;;;.;.;;;;;.;.;;;;;.;.;;;.;.;;.;S;S;S;.;.;::;;.;::;;.;::;;.;::;;.;::;;.;";
	var chaineDecompresse	= "";
	var C = new Array();
	for( var i = 0; i < baseT.length; i++ )
		C[ baseT.charAt( i ) ] = i;
	var i = 0;
	var l = 0;
	for( ; str.length; str = str.substr( i ) )
	{
		i = 0;
		if( struct_trame.charAt( l ) == "S" )
		{
			while( str.charAt( i ) != ";" )
			chaineDecompresse += str.charAt( i++ );
			i++;
			
			//
			l++;
			
			chaineDecompresse += ";";
		}
		else
		{
			var multiplicateur = 1;
			var res = 0;
			var end = 0;
			for( i = 0; i < str.length && !end; i++ )
			{
				var CH = str.charAt( i );
				if( CH == '-' )
					chaineDecompresse += '-';
					else
					{
						if( C[ CH ] < base )
							res += multiplicateur * C[ CH ];
						else
						{
							res += multiplicateur * ( C[ CH ] - base );
							end = 1;
						}
						multiplicateur *= base;
					}
				}
				res -= 10;
				if( res < 10 && ( struct_trame.charAt( l - 1 ) == "." || struct_trame.charAt( l - 1 ) == ":" ) )
					res = "0" + res;
					chaineDecompresse += res;
				
				if( struct_trame.charAt( l ) == "." )
					chaineDecompresse += ".";
				else
					if( struct_trame.charAt( l ) == ":" )
						chaineDecompresse += ":";
					else
						chaineDecompresse += ";";
			}
			l++;
		}
	return chaineDecompresse;
}

function pourcentageFormate( initial )
{	
	initial = "" + parseFloat( initial );
	if( initial.charAt( 0 ) == '+' || initial.charAt( 0 ) == '-' )
		return initial + "%";
	return "+" + initial + "%";
}



var mutex_supprimeBloc = false;
function supprimeBloc( titreBloc )
{
	if( mutex_supprimeBloc ) return;
	mutex_supprimeBloc = true;
	window.setTimeout( "_supprimeBloc( '" + titreBloc + "')", 200 );
}

function _supprimeBloc( titreBloc )
{
	if( titreBloc == chaineTransformee( "CSA_LIB_COURT" ) )
	// Retablir tout
	{
		window.resizeTo( largeurFenetreOrigine, hauteurFenetreOrigine );
		for( var i in structPage )
			if( i.substr( 0, 4 ) == "TMP_" )
				structPage[ i.slice( 4 ) ] 
					= structPage[ i ];
		O();
		mutex_supprimeBloc = false;
		return;
	}
	
	structPage[ "TMP_" + titreBloc ] = structPage[ titreBloc ];
	structPage[ titreBloc ] = null;	
	O();
	if( structPage[ "TMP_" + titreBloc ] ) window.resizeBy( -1 * largeurColonne * structPage[ "TMP_" + titreBloc ][ 0 ].length, 0 );
	mutex_supprimeBloc = false;
}

function catchKeyboard( event )
{
	var key = ( document.all )?event.keyCode:event.which;
	switch( key )
	{
		case 0	: window.frames[ 2 ].document.getElementById( "zoneSaisie" ).style.visibility="hidden"; return;
		case 3	: if( navigator.appVersion.indexOf( "Macintosh" ) >= 0 )
				window.frames[ 2 ].document.getElementById( "formSico" ).submit();
			  return;
		case 27	: window.frames[ 2 ].document.getElementById( "zoneSaisie" ).style.visibility="hidden"; return;
		case 42	: focusAll(); return;
		case 43	: achat(); window.frames[ 2 ].focus(); return;
		case 45	: vente(); window.frames[ 2 ].focus(); return;
		case 46	:
			if( window.frames[ 2 ].document.getElementById( sicovamFieldName ).value.length == 0 )
				return;
			rechercheDansNouvelleFenetre	= true;
			var val = window.frames[ 2 ].document.getElementById( sicovamFieldName ).value.toUpperCase().replace( /^0/, "" );
//			alert( ">>>" + val );
			parent.stub.document.location	= "/f"
							+ val;
			return;
		case 63	: ouvrirAide();
	}
	window.frames[ 2 ].document.getElementById( "zoneSaisie" ).style.visibility="visible";
	window.frames[ 2 ].document.getElementById( sicovamFieldName ).focus();
	if( navigator.appVersion.indexOf( "Macintosh" ) >= 0 )
	{
		var n = ( parseInt( key ) - 48 );
		if( n >= 0 && n <= 9 )
			window.frames[ 2 ].document.getElementById( sicovamFieldName ).value += "" + n;
	}
	return false;
}

var rechercheDansNouvelleFenetre = false;
function callBackRecherche( _serveurValueIndex, listeValeursCompressee, _chaineCAC, horloge )
{
	window.frames[ 2 ].document.getElementById( sicovamFieldName ).value="";
	if( _serveurValueIndex == null )
	{
		alert( ' - Valeur non trouvée - ' );
		rechercheDansNouvelleFenetre = false;
		return;
	}
	if( document.all && rechercheDansNouvelleFenetre )
	{
		rechercheDansNouvelleFenetre = false;
		ouvrirNouvelleFenetre( "/F" + _serveurValueIndex.slice( 2, 24 ) + flag );
		return;
	}
	serveurValueIndex 		= _serveurValueIndex;
	ancienneListeValeursCompressee	= null;
	ancienneListeValeurs		= null;
	ancienArrayValeurs		= null;
	O( listeValeursCompressee, horloge, _chaineCAC );
	rafraichissementInterditApresRechVal = true;
	window.frames[ 2 ].document.getElementById( sicovamFieldName ).value = "";
	window.frames[ 2 ].document.getElementById( "zoneSaisie" ).style.visibility = "hidden";
}


var premierPassage	= true;
var handlerSecurite	= window.setTimeout( "window.close()", 10000 );
var codeFrameFille	=
"<HTML>" +
"<HEAD><STYLE><!-\-" +
".TABLEAU{font-family: Verdana , Arial, Helvetica, sans-serif;font-size: 11px;background-color: " + backColor + " }" +
".TABLEAUENTETE{ background-color: " + topColor + ";color: " + fontTopColor + "; }" +
".sico{font-size:10px;color:#000000;background:#FFFFFF;font-family:verdana;text-align:right;border-width:0;height:12;padding:0px}" +
".bouton{padding:0px;background:" + topColor + "; height:11px; width: 9px; font-family:arial; text-decoration: bold; font-size:7px;font-color:"  + fontTopColor + ";color:"  + fontTopColor + "; border-width :1px; text-align:center; margin-top:0px; margin-left:1px; margin-bottom:3px; valign:top}" +
".diode{padding:0px;background:#FFFFFF; border-color:black; height:5px; width: 12px; font-family:arial; text-decoration: bold; font-size:7px; font-color:black; border-width :1px; margin-top:0px; margin-left:1px; margin-bottom:0px; text-align:center; valign:top}" +
".icone{padding:0px;background:" + topColor + "; height:11px; width: 16px; font-family:arial; text-decoration: bold; font-size:7px; font-color:" + fontTopColor + "; border-width :1px; text-align:center; valign:top;color: " + fontTopColor + "}" +
"--></STYLE></HEAD>" +
( ( document.all )?
	"<BODY onkeypress='parent.catchKeyboard(window.event)' leftmargin='0' topmargin='0' align='left' valign='top'>"
	:
	"<BODY leftmargin='0' topmargin='0' align='left' valign='top'>"
) +
"<form name='formSico' target='stub' method='post' action='#' " +
"onsubmit='{sicovam.value = " +
sicovamFieldName +
".value;" +
"if( sicovam.value.length == 0 ) return false;" +
"parent.stub.document.location=\"/f\" + document.getElementById( parent.sicovamFieldName ).value.toUpperCase().replace( /^0/, \"\" );" +
"return false;" +
"}'>" +
( ( navigator.appVersion.indexOf( "Macintosh" ) < 0 ) ?
	"<div id='objetDonnees' style='position:absolute;top:0px;left:0px;visibility:visible'></div>"
	:
	"ZONE_AFFICHAGE"
) +

//"<div id='buffer' style='position:absolute;top:0px;left:0px;visibility:hidden'></div>" +
// Zone saisie
"<div id='zoneSaisie' style='position:absolute;top:30px;left:0px;visibility:hidden;border:10'>" +
"<table class='TABLEAU' CELLSPACING='0' CELLPADDING='0' style='text-align: right'  border='1'>" +
"<tr class='TABLEAUENTETE'>" +
"<td align='left'>" +
"<input type='button' class='bouton' value='X' onclick='zoneSaisie.style.visibility=\"hidden\"'>" +
"Changer valeur" +
"</td></tr>" +
"<tr><td>" +
"<input type='text' class='sico' id='" +
	sicovamFieldName +
	"' name='" +
	sicovamFieldName +
	"' onkeypress=\"if( event.keyCode == 43 || event.keyCode == 45 )return false; return true;\" onmousedown=\"return true;\"><br>" +
	"<input type='hidden' name='sicovam'>" +
"<a href='javascript:formSico.submit();'>" +
"</a>" +
"</td></tr>" +
"</table>" +
"</div>" +
// Fin zone saisie		
"</form>" +
"</BODY>" +
"</html>";



var debugprem = true;

var s = "";

var rafraichissementInterditApresRechVal = false;
function O( listeValeursCompressee, horloge, _chaineCAC )
{
	if( debugprem )
	{
		//alert( listeValeursCompressee );
		if( listeValeursCompressee.substring( 0, 2 ) == "Ä«" )
		{
			alert( "Ca va planter" );
			listeValeursCompressee =
			"Ä3L¢" +
			listeValeursCompressee.substring( 2 );
		}
		var sss = "";
		
		
		var spl = 
			decomp( listeValeursCompressee )
			.replace( /\'/g, "`" )
			.split( ";" );
		
		for( var i in spl )
			sss += i + "(" + listeOrdonneeChamps[ i + 5 ] + "): " + spl[ i ] + "\t";
		
//		alert( sss );
		
			
//		alert( ( decomp( listeValeursCompressee ) ).replace( /\'/g, "`" ) );
		debugprem = false;
	}

	if( ( "" + document.referrer ).length )
	{
		go4reload = function(){
		}
		return;
	}
	
	if( listeValeursCompressee.substring( 0, 2 ) == "Ä«" )
	{
		listeValeursCompressee =
		"Ä3L¢" +
		listeValeursCompressee.substring( 2 );
	}

	listeValeursCompressee =
	listeValeursCompressee.replace( "E0008375528", "FAUXPEUGEOT" );

	if( rafraichissementInterditApresRechVal )
	{
		rafraichissementInterditApresRechVal = false;
		return;
	}
	window.clearTimeout( handlerSecurite );
	handlerSecurite	= window.setTimeout( "window.close()", 20000 );
	if(	listeValeursCompressee	!= null					&&
		listeValeursCompressee	== ancienneListeValeursCompressee	&&
		_chaineCAC		== ancienneChaineCAC			&&
		!etatAllume )
	{
		animerDiode();
		// Cas où tous les champs sont identiques:
		// On réactive seulement la led si l'horloge du flux a changé
		if( horloge != ancienneHorloge )
			animerDiode2();
		ancienneHorloge = horloge;
		return;
	}
	
	etatAllume = false;
	
	if(	listeValeursCompressee	!= ancienneListeValeursCompressee ||
		_chaineCAC		!= ancienneChaineCAC )
		etatAllume		= true;
	
	if( listeValeursCompressee != null )
	{
		listeValeurs	= _chaineCAC + ";" + ( decomp( listeValeursCompressee ) ).replace( /\'/g, "`" );
		arrayValeurs	= listeValeurs.split( ";" );
		chaineCAC	= _chaineCAC;
	}
	s = "";
	s += "<table><tr>";
	for( var titreBloc in structPage )
	{
		if( titreBloc.substring( 0, 4 ) == "TMP_" || structPage[ titreBloc ] == null ) continue;
	
		s +=	"<td>" +
				"<table class='TABLEAU' CELLSPACING='0' CELLPADDING='0' style='text-align: right'>" +
				"<tr class='TABLEAUENTETE'>" +
				"<td align='left' colspan='" +
				parseInt( structPage[ titreBloc ][ 0 ].length ) +
				"'>" +
				( titreBloc == "CSA_LIB_COURT" ?
					//"<img src='" + serveurAssocieBV + "/images/autoRefresh/help.gif' border='0' valign='down'>" +
					"<input type='button' class='bouton' style='width:11px'; value='>>' onclick='parent.supprimeBloc( \"" +
					chaineTransformee( titreBloc ) +
					"\"); return false;'>"
					:
					"<input type='button' class='bouton' value='X' onclick='parent.supprimeBloc( \"" +
					chaineTransformee( titreBloc ) +
					"\"); return false;'>"
				) +
				"&nbsp;" +
				chaineTransformee( titreBloc )	+
				"</td>" +
				"</tr>";
	
		for( var i in structPage[ titreBloc ] )
		{
			s += "<tr>";
			for( var j in structPage[ titreBloc ][ i ] )
			{	
				var nomChamp = structPage[ titreBloc ][ i ][ j ];
				var couleur = couleurAffichage( nomChamp );
				if( couleur == null )
					s +=	"<td width='" +
						largeurColonne +
						"'>";
				else
				{
					s +=	"<td width='" +
						largeurColonne +
						"' bgcolor='" +
						couleur +
						"'>";
				}
				s +=	chaineTransformee( nomChamp );
				s +=	"</td>";
			}
			s += "</tr>";
		}		
		s += "</table>";
		s += "</td>";
	}
	s += "</table>";
	
	if( document.all )
		document.title
			= arrayValeurs[ indexChamp[ "CSA_LIB_COURT" ] ]
			+ ": "
			+ chaineTransformee( "CSA_CRS_DERNIER" )
			+ " "
			+ chaineTransformee( "CSA_VAR_VEILLE" )
			+ (	( flag != "NGI877" ) ?
				" - * * * T R A D E R Q U O T E S * * * " :
				""
				);
	
	if( premierPassage )
	{
	//	alert( 'Premier passage' );
		window.frames[ 2 ].document.close();
		window.frames[ 2 ].document.open();
		window.frames[ 2 ].document.write( codeFrameFille ); //doc.write		
		window.frames[ 2 ].focus();
		
		if( !document.all )
		{
			window.frames[ 2 ].document.getElementById( sicovamFieldName ).focus();
			window.frames[ 2 ].document.onkeypress = catchKeyboard;
		}
		premierPassage = false;
	//	alert( 'Fin premier passage' );
	}
	

	if( navigator.appVersion.indexOf( "Macintosh" ) < 0 )
	{
		window.frames[ 2 ].document.getElementById( "objetDonnees" ).innerHTML		= s;
	}
	else
	{
		window.frames[ 2 ].document.close();
		window.frames[ 2 ].document.open();
		window.frames[ 2 ].document.write( codeFrameFille.replace( "ZONE_AFFICHAGE", s ) );
	}
	ancienneListeValeurs		= listeValeurs;
	ancienneChaineCAC		= chaineCAC;
	ancienArrayValeurs		= arrayValeurs;
	ancienneHorloge			= horloge;
	ancienneListeValeursCompressee	= listeValeursCompressee;
	
	animerDiode();		
	animerDiode2();		
	//alert( 'Fin callback O' );
}


var inc = 0;

function go4reload()
{
	window.frames[ 0 ].document.location = serveurValueIndex;
}

// 2 heures de fonctionnement
window.setTimeout( "top.window.close()", 3600000 * 2 );
//window.setInterval( "go4reload()", 2000 );
window.setInterval( "go4reload()", fdslkjb8928d( flag ) );

</script>

<frameset
	rows='0,0,*'
	frameborder='0'
	onunload='window.close();'
	onload='window.autoRefresh_dynamicPart.location="/EE4MW0mfgE7E.sqI.1GkfLs5874"'
	border='0'>
<frame name='autoRefresh_dynamicPart' src='/vide'>
<frame name='stub' src='/vide'>
<frame name='autoRefresh_staticPart' src='/vide'>
</frameset>" );

</html>



